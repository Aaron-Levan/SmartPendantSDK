# Smart Pendant Extension SDK Java Quick-Start

This guide will walk you though creating a simple 'hello world' extension using Java on your desktop development environment.

## Setup

First, you will need to install a Java Development Kit (JDK) on your desktop.  The Smart Pendant Java execution environment uses [OpenJDK 10](https://openjdk.java.net/), but compatible JDK implementations for your platform will suffice - such as Oracle JDK 10 or later.

Under a Debian-based Linux desktop (such as Ubuntu) install OpenJDK via:

    sudo apt install openjdk-11-jdk

On Windows or Mac OS X, visit [jdk.java.net](https://jdk.java.net/) for downloads and installation instructions.

If you prefer, many Integrated Development Environments (IDEs) come packaged with a Java JDK, such as the Open Source [Eclipse](https://www.eclipse.org/) from IBM, Apache [NetBeans](https://netbeans.apache.org/) or [IntelliJ IDEA](https://www.jetbrains.com/idea/) by JetBrains. 

Next, you will need to obtain the Extension SDK library `yaskawa-ext.jar` file and two jar files on which it depends: `libthrift-0.11.0.jar` [Apache Thrift](https://thrift.apache.org/) implementation and `slf4j-api.jar` ([Simple Logging Facade for Java](https://www.slf4j.org/)).
While it is possible to build the Extension SDK, Thrift and SL4J libraries from their sources, it is simpler to download the latest versions from [here]().

*TODO: provide binary downloads*
*TODO: add version number to yaskawa-ext.jar*

## Extension Main

Create a single `MyExtension.java` text file which will contain the Main entry point and the extension code.  

If using an IDE, you may wish to use the IDEs built-in project management; otherwise just use the text editor of your choice.  The extension application does not require and Java-native GUI components, as the User Interface will be implemented using the Extension API and hosted within the Smart Pendant app.  Hence, if using an IDE, a 'command line' application project type will be sufficient.

Paste in the following source:

```java
import java.io.IOException;
import java.util.*;

import org.apache.thrift.TException;
import org.apache.thrift.transport.TTransportException;

import yaskawa.ext.*;



public class MyExtension {

    public MyExtension() throws TTransportException, Exception
    {
        var version = new Version(1,0,0);
        var languages = Set.of("en");

        extension = new Extension("mylaunchkey",
                                  "dev.my-extension", 
                                  version, "Acme Me", languages,
                                  "localhost", -1);

        // obtain references to the Pendant and Controller API functions
        pendant = extension.pendant();
        controller = extension.controller();
    }

    protected Extension extension;
    protected Pendant pendant;
    protected Controller controller;

    public void run() throws TException, IOException
    {
        // Query the verson of the SP API we're communicating with:
        System.out.println("API version: "+extension.apiVersion());

        // Send a message to the SP log
        extension.info("Hello Smart Pendant, I'm MyExtension");
    }


    public static void main(String[] args) 
    {
        try {

            MyExtension myExtension = new MyExtension();
            myExtension.run();

        } catch (Exception e) {
            System.out.println("Exception: "+e.toString());    
        }
        
    }

}
```

As required by Java, we're declaring a class `MyExtension` with the same name as our file.  It contains a standard static `main` entry point.

Once `main` instantiates the `MyExtension` class, the first thing the instance does is create an instance of `Extension`.  This triggers a connection to the Smart Pendant app API server.  The Extension API is contained in the `yaskawa.ext.api` namespace, which contains client classes automatically generated by Apache Thrift from the Thrift interface declarations (more on this later).  There are also additional convenience and wrapper classes in the `yaskawa.ext` namespace.
All of these classes are found in the `yaskawa-ext.jar` SDK library.

The arguments to the `Extension` constructor are documented in the class reference, but include a unique launch key that is passed to your extension on the command-line when launched by Smart Pendant (ignored during development), a unique string used to globally identify your extension (following the Java-style reverse-DNS convension is advisable), your extension's version, vendor name and languages supported by your user-interface (if any) and IP address of the API server (Smart Pendant).

As mentioned, the Extension API is divided into Pendant functions (UI integration) and Controller functions (robot & controller related).  References to these API services are obtained by the `extension.pendant()` and `extension.controller()` respectivelly.

Our simple extension calls `extension.apiVersion()` to query the Smart Pendant API server about which version of the API is it supporting.  Future versions of the API are planned to be backward-compatible (as supported by the Thrift protocol).  Finally, it calls one of the standard logging functons `extension.info`, which causes the passed string to be printed in the Smart Pendant global log.

*TODO: provide information on how to stream the log to a remote terminal in real-time*

### Building

If you are using an IDE, you'll want to add the three `.jar` files above to your project dependencies and compile the `MyExtension.java` file and place it in a jar named `MyExtension.jar`.

If using the command-line, you can issue: (or place this in a simple `build.sh` script, for example)

```bash
javac -cp libthrift-0.11.0.jar:slf4j-api.jar:yaskawa-ext.jar --add-modules java.xml.ws.annotation *.java
jar -cfe MyExtension.jar MyExtension MyExtension.class
```

(you'll need to adjust the paths to your jar files appropriately unless they're in the current directory)

### Running

Once built, we can run our extension, but it will throw an exception since the Smart Pendant app API server isn't running.
You'll also need a concrete SL4J logging loggig implementation - such as the `slf4j-simple.jar` file below which logs to standard output.

```bash
java -cp yaskawa-ext.jar:libthrift-0.11.0.jar:slf4j-api.jar:slf4j-simple.jar:MyExtension.jar:. MyExtension
```
(again, adjusting the paths to where your jar files are located)

You should recieve a

    Exception: org.apache.thrift.transport.TTransportException: java.net.ConnectException: Connection refused (Connection refused)

for your trouble :)

### Connecting to the Smart Pendant API

#### Physical Smart Pendant 

If you have a Smart Pendant available, you can direct your desktop extension to connect to the API via the network.  

*TODO: explain how to do this.  Consider running API on port that is redirected by controller from LAN2 -> LAN1, so that the API can be accessed from LAN2*

